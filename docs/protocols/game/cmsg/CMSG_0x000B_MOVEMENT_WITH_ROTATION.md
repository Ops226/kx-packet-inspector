# CMSG_MOVEMENT_WITH_ROTATION (0x000B)

**Direction**: Client -> Server
**Status**: Confirmed (Schema-Driven, Live-Validated)

## Summary

This packet is sent by the client when the player's movement involves a change in rotation, such as when starting to move or changing direction. It is a complex, schema-driven packet with a large, variable-size payload.

The packet is generated by the unified player-action pipeline. A high-level data aggregator gathers extensive state information, including both position and rotation vectors, and passes this data to the generic serialization engine. The large size of the live packet is a result of the aggregator filling in the optional blocks and variable buffers defined in the packet's schema.

## Construction Chain

1.  **Data Aggregation (`FUN_1410225DE`):** The high-level aggregator function gathers player position, rotation, and other state data.
2.  **Generic Builder Chain:** The aggregator calls down a chain of generic builders (`FUN_14100C87D`, `FUN_1410213CB`).
3.  **Serialization (`CMSG::BuildAndSendPacket`):** The final builder calls the main serialization engine, which uses the schema for opcode `0x000B` to build the packet.
4.  **Sending Mechanism (Buffered Stream):** The packet is written to the main `MsgSendContext` buffer and sent in a batch when `MsgConn::FlushPacketBuffer` is called.

## Schema Information

- **Opcode:** `0x000B`
- **Schema Address (Live):** `0x7FF6E0EA2FD0`

## Packet Structure (from Schema)

The schema defines a complex 11-field structure. The `Small Buffer` and `Optional Block` fields account for the large size of the live packet.

| Field Order | Type | Name | Notes |
|---|---|---|---|
| 1 | `short` | field_0 | Typecode: 0x01 |
| 2 | Compressed `int` | field_1 | Typecode: 0x04 |
| 3 | `byte` | field_2 | Typecode: 0x02 |
| 4 | Compressed `int` | field_3 | Typecode: 0x04 |
| 5 | Small Buffer | field_4 | Typecode: 0x14 |
| 6 | Optional Block | field_5 | Typecode: 0x0F |
| 7 | **`float[3]`** | **Position** | Typecode: 0x08. (X, Y, Z coordinates) |
| 8 | **`float[4]`** | **Rotation** | Typecode: 0x0A (likely). A 4-component quaternion. |
| 9 | Optional Block | field_8 | Typecode: 0x0F |
| 10 | `short` | field_9 | Typecode: 0x01 |
| 11 | `unknown` | field_10 | Typecode: 0x3E. |

## Live Packet Sample (Size 103 bytes)
`15:40:34.067 [S] CMSG_MOVEMENT_WITH_ROTATION Op:0x000B | Sz:103 | 0B 00 9B 00 85 EC 01 00 C7 DB 80 80 08 02 6B 01 01 5E 5A 6A 43 3A 06 98 41 E8 73 02 42 F2 24 FB 3B ...`