# SMSG 0x0046 — Array/Table Update

Status: Confirmed (code-backed)

Dispatch Path:
- Dispatcher: FUN_14025DA50, case 0x46 (index = opcode − 0x2B)
- Schema: &DAT_142513BB0 → passed to FUN_140FD4D50 (typed arg builder)
- BuildArgs Semantics: Msg_ParseAndDispatch_BuildArgs (inline exemplar at 0x140FD4417)
- Handler code slice (addresses approximate):
  - 0x14025EC22..0x14025EC1D

Behavior Summary:
- Ensures/creates a target slot at param_1 + 0x128 for the table (FUN_140257E70 / FUN_1402541C0).
- Resets container state via FUN_140265260(lVar15 + 0x10).
- Iterates an entry list sourced from the schema block:
  - Base pointer = *(int**)(lVar16 + 0x13)
  - Count byte = *(u8*)(lVar16 + 0x12)
  - Each entry stride = 5 × 4 bytes (u32)
- For each entry if entry[4] != 0:
  - Compute an index with FUN_140250360(puVar26, entry, &local_68)
  - If target array needs expansion: FUN_140265970(puVar26, *puVar26 * 2), then recompute index
  - Copy a pair of u64 (from two u32 pairs) and a trailing u32 flag into the packed array
  - Update a parallel 0x14-field for the computed index (classification/id), increment count

Key Instructions (evidence):
- FUN_140FD4D50(&DAT_142513BB0)
- lVar15 = FUN_140257E70(param_1 + 0x128, (ulonglong*)(lVar16 + 2)); if 0 → FUN_1402541C0 to create
- FUN_140265260(lVar15 + 0x10) resets structures
- piVar10 = *(int**)(lVar16 + 0x13); end = piVar10 + count*5 (count = *(u8*)(lVar16 + 0x12))
- For each 5×u32 entry with entry[4] != 0:
  - idx = FUN_140250360(puVar26, entry, &local_68) & 0xFFFFFFFF
  - Ensure capacity via FUN_140265970 when near limit; then write:
    • 16 bytes from entry[0..3] into out[idx] (two u64s)
    • outMeta[idx] (0x14 field) = local_68._0_4_
    • outFlag[idx] = entry[4]

Field Layout (inferred from access pattern):
- Schema root (lVar16):
  - +0x12: u8 count
  - +0x13: pointer to first entry (array of 5×u32 per element)
  - Entries: [u32 a0, u32 a1, u32 a2, u32 a3, u32 flag]
- Destination container (param_1 + 0x128):
  - Holds a packed array of:
    • Two u64 values built from (a0,a1) and (a2,a3)
    • A metadata/classification value for the index (written via the 0x14 lane)
    • A terminal u32 flag

Notes:
- This is a classic “install/refresh” message: replaces or updates a table of entries. Exact per-field types are derived via BuildArgs; concrete widths above are observed by copy size and write sites in handler.
